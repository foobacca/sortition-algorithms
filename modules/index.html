
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A package containing algorithms for sortition - democratic lotteries.">
      
      
        <meta name="author" content="Sortition Foundation">
      
      
        <link rel="canonical" href="https://sortitionfoundation.github.io/sortition-algorithms/modules/">
      
      
        <link rel="prev" href="../api-reference/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Modules - sortition-algorithms</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sortition_algorithms.adapters" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="sortition-algorithms" class="md-header__button md-logo" aria-label="sortition-algorithms" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            sortition-algorithms
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modules
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sortitionfoundation/sortition-algorithms" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    sortitionfoundation/sortition-algorithms
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="sortition-algorithms" class="md-nav__button md-logo" aria-label="sortition-algorithms" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    sortition-algorithms
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sortitionfoundation/sortition-algorithms" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    sortitionfoundation/sortition-algorithms
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adapters
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.adapters" class="md-nav__link">
    <span class="md-ellipsis">
      adapters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.adapters.GSheetAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      GSheetAdapter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GSheetAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.adapters.GSheetAdapter.messages" class="md-nav__link">
    <span class="md-ellipsis">
      messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation" class="md-nav__link">
    <span class="md-ellipsis">
      committee_generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_any_committee" class="md-nav__link">
    <span class="md-ellipsis">
      find_any_committee
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_distribution_leximin" class="md-nav__link">
    <span class="md-ellipsis">
      find_distribution_leximin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_distribution_maximin" class="md-nav__link">
    <span class="md-ellipsis">
      find_distribution_maximin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_distribution_nash" class="md-nav__link">
    <span class="md-ellipsis">
      find_distribution_nash
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.standardize_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_distribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core" class="md-nav__link">
    <span class="md-ellipsis">
      core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.find_random_sample" class="md-nav__link">
    <span class="md-ellipsis">
      find_random_sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.lottery_rounding" class="md-nav__link">
    <span class="md-ellipsis">
      lottery_rounding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.pipage_rounding" class="md-nav__link">
    <span class="md-ellipsis">
      pipage_rounding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.run_stratification" class="md-nav__link">
    <span class="md-ellipsis">
      run_stratification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.selected_remaining_tables" class="md-nav__link">
    <span class="md-ellipsis">
      selected_remaining_tables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.errors" class="md-nav__link">
    <span class="md-ellipsis">
      errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features" class="md-nav__link">
    <span class="md-ellipsis">
      features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureCollection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureCollection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.check_desired" class="md-nav__link">
    <span class="md-ellipsis">
      check_desired
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.check_min_max" class="md-nav__link">
    <span class="md-ellipsis">
      check_min_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.maximum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      maximum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.minimum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      minimum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.set_default_max_flex" class="md-nav__link">
    <span class="md-ellipsis">
      set_default_max_flex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureValues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureValues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues.maximum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      maximum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues.minimum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      minimum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues.set_default_max_flex" class="md-nav__link">
    <span class="md-ellipsis">
      set_default_max_flex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features.read_in_features" class="md-nav__link">
    <span class="md-ellipsis">
      read_in_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.find_sample" class="md-nav__link">
    <span class="md-ellipsis">
      find_sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.find_sample.find_random_sample_legacy" class="md-nav__link">
    <span class="md-ellipsis">
      find_random_sample_legacy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features" class="md-nav__link">
    <span class="md-ellipsis">
      people_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.MaxRatioResult" class="md-nav__link">
    <span class="md-ellipsis">
      MaxRatioResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures" class="md-nav__link">
    <span class="md-ellipsis">
      PeopleFeatures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PeopleFeatures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.delete_all_with_feature_value" class="md-nav__link">
    <span class="md-ellipsis">
      delete_all_with_feature_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.find_max_ratio_category" class="md-nav__link">
    <span class="md-ellipsis">
      find_max_ratio_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.handle_category_full_deletions" class="md-nav__link">
    <span class="md-ellipsis">
      handle_category_full_deletions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.prune_for_feature_max_0" class="md-nav__link">
    <span class="md-ellipsis">
      prune_for_feature_max_0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.select_person" class="md-nav__link">
    <span class="md-ellipsis">
      select_person
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.WeightedSample" class="md-nav__link">
    <span class="md-ellipsis">
      WeightedSample
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WeightedSample">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.WeightedSample.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.simple_add_selected" class="md-nav__link">
    <span class="md-ellipsis">
      simple_add_selected
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people" class="md-nav__link">
    <span class="md-ellipsis">
      people
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People" class="md-nav__link">
    <span class="md-ellipsis">
      People
    </span>
  </a>
  
    <nav class="md-nav" aria-label="People">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People.find_person_by_position_in_category" class="md-nav__link">
    <span class="md-ellipsis">
      find_person_by_position_in_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People.households" class="md-nav__link">
    <span class="md-ellipsis">
      households
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People.matching_address" class="md-nav__link">
    <span class="md-ellipsis">
      matching_address
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.settings" class="md-nav__link">
    <span class="md-ellipsis">
      settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils.RandomProvider" class="md-nav__link">
    <span class="md-ellipsis">
      RandomProvider
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils.StrippedDict" class="md-nav__link">
    <span class="md-ellipsis">
      StrippedDict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils.print_ret" class="md-nav__link">
    <span class="md-ellipsis">
      print_ret
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.adapters" class="md-nav__link">
    <span class="md-ellipsis">
      adapters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.adapters.GSheetAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      GSheetAdapter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GSheetAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.adapters.GSheetAdapter.messages" class="md-nav__link">
    <span class="md-ellipsis">
      messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation" class="md-nav__link">
    <span class="md-ellipsis">
      committee_generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_any_committee" class="md-nav__link">
    <span class="md-ellipsis">
      find_any_committee
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_distribution_leximin" class="md-nav__link">
    <span class="md-ellipsis">
      find_distribution_leximin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_distribution_maximin" class="md-nav__link">
    <span class="md-ellipsis">
      find_distribution_maximin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.find_distribution_nash" class="md-nav__link">
    <span class="md-ellipsis">
      find_distribution_nash
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.committee_generation.standardize_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_distribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core" class="md-nav__link">
    <span class="md-ellipsis">
      core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.find_random_sample" class="md-nav__link">
    <span class="md-ellipsis">
      find_random_sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.lottery_rounding" class="md-nav__link">
    <span class="md-ellipsis">
      lottery_rounding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.pipage_rounding" class="md-nav__link">
    <span class="md-ellipsis">
      pipage_rounding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.run_stratification" class="md-nav__link">
    <span class="md-ellipsis">
      run_stratification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.core.selected_remaining_tables" class="md-nav__link">
    <span class="md-ellipsis">
      selected_remaining_tables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.errors" class="md-nav__link">
    <span class="md-ellipsis">
      errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features" class="md-nav__link">
    <span class="md-ellipsis">
      features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureCollection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureCollection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.check_desired" class="md-nav__link">
    <span class="md-ellipsis">
      check_desired
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.check_min_max" class="md-nav__link">
    <span class="md-ellipsis">
      check_min_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.maximum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      maximum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.minimum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      minimum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureCollection.set_default_max_flex" class="md-nav__link">
    <span class="md-ellipsis">
      set_default_max_flex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureValues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureValues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues.maximum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      maximum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues.minimum_selection" class="md-nav__link">
    <span class="md-ellipsis">
      minimum_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.features.FeatureValues.set_default_max_flex" class="md-nav__link">
    <span class="md-ellipsis">
      set_default_max_flex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.features.read_in_features" class="md-nav__link">
    <span class="md-ellipsis">
      read_in_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.find_sample" class="md-nav__link">
    <span class="md-ellipsis">
      find_sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.find_sample.find_random_sample_legacy" class="md-nav__link">
    <span class="md-ellipsis">
      find_random_sample_legacy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features" class="md-nav__link">
    <span class="md-ellipsis">
      people_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.MaxRatioResult" class="md-nav__link">
    <span class="md-ellipsis">
      MaxRatioResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures" class="md-nav__link">
    <span class="md-ellipsis">
      PeopleFeatures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PeopleFeatures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.delete_all_with_feature_value" class="md-nav__link">
    <span class="md-ellipsis">
      delete_all_with_feature_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.find_max_ratio_category" class="md-nav__link">
    <span class="md-ellipsis">
      find_max_ratio_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.handle_category_full_deletions" class="md-nav__link">
    <span class="md-ellipsis">
      handle_category_full_deletions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.prune_for_feature_max_0" class="md-nav__link">
    <span class="md-ellipsis">
      prune_for_feature_max_0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.PeopleFeatures.select_person" class="md-nav__link">
    <span class="md-ellipsis">
      select_person
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.WeightedSample" class="md-nav__link">
    <span class="md-ellipsis">
      WeightedSample
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WeightedSample">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.WeightedSample.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people_features.simple_add_selected" class="md-nav__link">
    <span class="md-ellipsis">
      simple_add_selected
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people" class="md-nav__link">
    <span class="md-ellipsis">
      people
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People" class="md-nav__link">
    <span class="md-ellipsis">
      People
    </span>
  </a>
  
    <nav class="md-nav" aria-label="People">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People.find_person_by_position_in_category" class="md-nav__link">
    <span class="md-ellipsis">
      find_person_by_position_in_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People.households" class="md-nav__link">
    <span class="md-ellipsis">
      households
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sortition_algorithms.people.People.matching_address" class="md-nav__link">
    <span class="md-ellipsis">
      matching_address
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.settings" class="md-nav__link">
    <span class="md-ellipsis">
      settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils.RandomProvider" class="md-nav__link">
    <span class="md-ellipsis">
      RandomProvider
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils.StrippedDict" class="md-nav__link">
    <span class="md-ellipsis">
      StrippedDict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sortition_algorithms.utils.print_ret" class="md-nav__link">
    <span class="md-ellipsis">
      print_ret
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Modules</h1>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.adapters"></a>
    <div class="doc doc-contents first">

        <p>Adapters for loading and saving data.</p>
<p>Initially we have CSV files locally, and Google Docs Spreadsheets.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.adapters.GSheetAdapter" class="doc doc-heading">
            <code>GSheetAdapter</code>


<a href="#sortition_algorithms.adapters.GSheetAdapter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/adapters.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GSheetAdapter</span><span class="p">:</span>
    <span class="n">scope</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;https://spreadsheets.google.com/feeds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://www.googleapis.com/auth/drive&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">hl_light_blue</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;backgroundColor&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">153</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">204</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">255</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">hl_orange</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;backgroundColor&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_json_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">gen_rem_tab</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;on&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_json_path</span> <span class="o">=</span> <span class="n">auth_json_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">:</span> <span class="n">gspread</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spreadsheet</span><span class="p">:</span> <span class="n">gspread</span><span class="o">.</span><span class="n">Spreadsheet</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_selected_tab_name</span> <span class="o">=</span> <span class="s2">&quot;Original Selected - output - &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_tab_name</span> <span class="o">=</span> <span class="s2">&quot;Selected&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns_selected_first</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_selected_blank_num</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_tab_name</span> <span class="o">=</span> <span class="s2">&quot;Remaining - output - &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_tab_default_size_rows</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_tab_default_size_cols</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_sheet_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">people_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_rem_tab</span> <span class="o">=</span> <span class="n">gen_rem_tab</span>  <span class="c1"># Added for checkbox.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return accumulated messages and reset&quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">messages</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gspread</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">ServiceAccountCredentials</span><span class="o">.</span><span class="n">from_json_keyfile_name</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_json_path</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">gspread</span><span class="o">.</span><span class="n">authorize</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spreadsheet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gspread</span><span class="o">.</span><span class="n">Spreadsheet</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spreadsheet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spreadsheet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_sheet_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opened Google Sheet: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">g_sheet_name</span><span class="si">}</span><span class="s2">&#39;. &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spreadsheet</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_tab_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spreadsheet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">tab_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spreadsheet</span><span class="o">.</span><span class="n">worksheets</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">tab_name</span> <span class="k">for</span> <span class="n">tab</span> <span class="ow">in</span> <span class="n">tab_list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_or_create_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_tab_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gspread</span><span class="o">.</span><span class="n">Worksheet</span><span class="p">:</span>
        <span class="c1"># this now does not clear data but increments the sheet number...</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tab_ready</span><span class="p">:</span> <span class="n">gspread</span><span class="o">.</span><span class="n">Worksheet</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tab_name_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_name</span><span class="si">}{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">other_tab_name_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">other_tab_name</span><span class="si">}{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">while</span> <span class="n">tab_ready</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab_exists</span><span class="p">(</span><span class="n">tab_name_new</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab_exists</span><span class="p">(</span><span class="n">other_tab_name_new</span><span class="p">):</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">tab_name_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_name</span><span class="si">}{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">other_tab_name_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">other_tab_name</span><span class="si">}{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">tab_name_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_name</span><span class="si">}{</span><span class="n">num</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">tab_ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spreadsheet</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">tab_name_new</span><span class="p">,</span>
                    <span class="n">rows</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_tab_default_size_rows</span><span class="p">,</span>
                    <span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_tab_default_size_cols</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">tab_ready</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g_sheet_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_tab_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">FeatureCollection</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_sheet_name</span> <span class="o">=</span> <span class="n">g_sheet_name</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab_exists</span><span class="p">(</span><span class="n">feature_tab_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in Google sheet: no tab called &#39;</span><span class="si">{</span><span class="n">feature_tab_name</span><span class="si">}</span><span class="s2">&#39; found. &quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">gspread</span><span class="o">.</span><span class="n">SpreadsheetNotFound</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Google spreadsheet not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">g_sheet_name</span><span class="si">}</span><span class="s2">. &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span>
        <span class="n">tab_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spreadsheet</span><span class="o">.</span><span class="n">worksheet</span><span class="p">(</span><span class="n">feature_tab_name</span><span class="p">)</span>
        <span class="n">feature_head</span> <span class="o">=</span> <span class="n">tab_features</span><span class="o">.</span><span class="n">row_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feature_body</span> <span class="o">=</span> <span class="n">_stringify_records</span><span class="p">(</span><span class="n">tab_features</span><span class="o">.</span><span class="n">get_all_records</span><span class="p">(</span><span class="n">expected_headers</span><span class="o">=</span><span class="p">[]))</span>
        <span class="n">features</span><span class="p">,</span> <span class="n">msgs</span> <span class="o">=</span> <span class="n">read_in_features</span><span class="p">(</span><span class="n">feature_head</span><span class="p">,</span> <span class="n">feature_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">+=</span> <span class="n">msgs</span>
        <span class="k">return</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_people</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">respondents_tab_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">People</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">people</span><span class="p">:</span> <span class="n">People</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab_exists</span><span class="p">(</span><span class="n">respondents_tab_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error in Google sheet: no tab called &#39;</span><span class="si">{</span><span class="n">respondents_tab_name</span><span class="si">}</span><span class="s2">&#39; found. &quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">gspread</span><span class="o">.</span><span class="n">SpreadsheetNotFound</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Google spreadsheet not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">g_sheet_name</span><span class="si">}</span><span class="s2">. &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span>

        <span class="n">tab_people</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spreadsheet</span><span class="o">.</span><span class="n">worksheet</span><span class="p">(</span><span class="n">respondents_tab_name</span><span class="p">)</span>
        <span class="c1"># if we don&#39;t read this in here we can&#39;t check if there are 2 columns with the same name</span>
        <span class="n">people_head</span> <span class="o">=</span> <span class="n">tab_people</span><span class="o">.</span><span class="n">row_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># the numericise_ignore doesn&#39;t convert the phone numbers to ints...</span>
        <span class="c1"># 1 Oct 2024: the final argument with expected_headers is to deal with the fact that</span>
        <span class="c1"># updated versions of gspread can&#39;t cope with duplicate headers</span>
        <span class="n">people_body</span> <span class="o">=</span> <span class="n">_stringify_records</span><span class="p">(</span>
            <span class="n">tab_people</span><span class="o">.</span><span class="n">get_all_records</span><span class="p">(</span>
                <span class="n">numericise_ignore</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">],</span>
                <span class="n">expected_headers</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading in &#39;</span><span class="si">{</span><span class="n">respondents_tab_name</span><span class="si">}</span><span class="s2">&#39; tab in above Google sheet.&quot;</span><span class="p">)</span>
        <span class="n">people</span><span class="p">,</span> <span class="n">msgs</span> <span class="o">=</span> <span class="n">read_in_people</span><span class="p">(</span><span class="n">people_head</span><span class="p">,</span> <span class="n">people_body</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">+=</span> <span class="n">msgs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">people_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">people</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">output_selected_remaining</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">people_selected_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">people_remaining_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">tab_original_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_or_create_tab</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_selected_tab_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_tab_name</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tab_original_selected</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">people_selected_rows</span><span class="p">)</span>
        <span class="n">tab_original_selected</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;A1:U1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hl_light_blue</span><span class="p">)</span>
        <span class="n">dupes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_rem_tab</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">:</span>
            <span class="n">tab_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_or_create_tab</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remaining_tab_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">original_selected_tab_name</span><span class="p">,</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">tab_remaining</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">people_remaining_rows</span><span class="p">)</span>
            <span class="n">tab_remaining</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;A1:U1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hl_light_blue</span><span class="p">)</span>
            <span class="c1"># highlight any people in remaining tab at the same address</span>
            <span class="c1"># TODO: do we ever actually hit this code? We should have deleted</span>
            <span class="c1"># all the people who might have been duplicates in selected_remaining_tables()</span>
            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">check_same_address</span><span class="p">:</span>
                <span class="n">address_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_remaining</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">csa</span><span class="p">)</span><span class="o">.</span><span class="n">col</span> <span class="k">for</span> <span class="n">csa</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">]</span>  <span class="c1"># type: ignore[union-attr]</span>
                <span class="n">dupes_set</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">people_remaining_rows</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">rowrem1</span> <span class="o">=</span> <span class="n">people_remaining_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                        <span class="n">rowrem2</span> <span class="o">=</span> <span class="n">people_remaining_rows</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">rowrem1</span> <span class="o">!=</span> <span class="n">rowrem2</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">rowrem1</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">rowrem2</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_cols</span><span class="p">):</span>
                            <span class="n">dupes_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">dupes_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dupes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dupes_set</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dupes</span><span class="p">))):</span>
                    <span class="n">tab_remaining</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dupes</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hl_orange</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dupes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">output_multi_selections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">multi_selections</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_rem_tab</span> <span class="o">==</span> <span class="s2">&quot;off&quot;</span>
        <span class="n">tab_original_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_or_create_tab</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_selected_tab_name</span><span class="p">,</span>
            <span class="s2">&quot;ignoreme&quot;</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tab_original_selected</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">multi_selections</span><span class="p">)</span>
        <span class="n">tab_original_selected</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;A1:U1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hl_light_blue</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.adapters.GSheetAdapter.messages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">messages</span><span class="p">()</span></code>

<a href="#sortition_algorithms.adapters.GSheetAdapter.messages" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return accumulated messages and reset</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/adapters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return accumulated messages and reset&quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">messages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.committee_generation"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.committee_generation.find_any_committee" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_any_committee</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

<a href="#sortition_algorithms.committee_generation.find_any_committee" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find any single feasible committee that satisfies the quotas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureCollection with min/max quotas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People object with pool members</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>desired size of the panel</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="sortition_algorithms.settings.Settings">Settings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings object containing configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple of (list containing one committee as frozenset of person_ids, empty list of messages)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="InfeasibleQuotasError">InfeasibleQuotasError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If quotas are infeasible</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SelectionError">SelectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If solver fails for other reasons</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/committee_generation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_any_committee</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find any single feasible committee that satisfies the quotas.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: FeatureCollection with min/max quotas</span>
<span class="sd">        people: People object with pool members</span>
<span class="sd">        number_people_wanted: desired size of the panel</span>
<span class="sd">        settings: Settings object containing configuration</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of (list containing one committee as frozenset of person_ids, empty list of messages)</span>

<span class="sd">    Raises:</span>
<span class="sd">        InfeasibleQuotasError: If quotas are infeasible</span>
<span class="sd">        SelectionError: If solver fails for other reasons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">agent_vars</span> <span class="o">=</span> <span class="n">_setup_committee_generation</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
    <span class="n">committee</span> <span class="o">=</span> <span class="n">_ilp_results_to_committee</span><span class="p">(</span><span class="n">agent_vars</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">committee</span><span class="p">],</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.committee_generation.find_distribution_leximin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_distribution_leximin</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

<a href="#sortition_algorithms.committee_generation.find_distribution_leximin" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a distribution over feasible committees that maximizes the minimum probability of an agent being selected
(just like maximin), but breaks ties to maximize the second-lowest probability, breaks further ties to maximize the
third-lowest probability and so forth.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureCollection with min/max quotas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People object with pool members</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>desired size of the panel</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="sortition_algorithms.settings.Settings">Settings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings object containing configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple of (committees, probabilities, output_lines)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>committees: list of feasible committees (frozenset of agent IDs)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>probabilities: list of probabilities for each committee</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="float">float</span>], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>output_lines: list of debug strings</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If Gurobi is not available</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/committee_generation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_distribution_leximin</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a distribution over feasible committees that maximizes the minimum probability of an agent being selected</span>
<span class="sd">    (just like maximin), but breaks ties to maximize the second-lowest probability, breaks further ties to maximize the</span>
<span class="sd">    third-lowest probability and so forth.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: FeatureCollection with min/max quotas</span>
<span class="sd">        people: People object with pool members</span>
<span class="sd">        number_people_wanted: desired size of the panel</span>
<span class="sd">        settings: Settings object containing configuration</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of (committees, probabilities, output_lines)</span>
<span class="sd">        - committees: list of feasible committees (frozenset of agent IDs)</span>
<span class="sd">        - probabilities: list of probabilities for each committee</span>
<span class="sd">        - output_lines: list of debug strings</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If Gurobi is not available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">GUROBI_AVAILABLE</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Leximin algorithm requires Gurobi solver which is not available&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_ret</span><span class="p">(</span><span class="s2">&quot;Using leximin algorithm.&quot;</span><span class="p">)]</span>
    <span class="n">grb</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Set up an ILP that can be used for discovering new feasible committees</span>
    <span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span> <span class="o">=</span> <span class="n">_setup_committee_generation</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="c1"># Find initial committees that cover every possible agent</span>
    <span class="n">committees</span><span class="p">,</span> <span class="n">covered_agents</span><span class="p">,</span> <span class="n">initial_output</span> <span class="o">=</span> <span class="n">_generate_initial_committees</span><span class="p">(</span>
        <span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">people</span><span class="o">.</span><span class="n">count</span>
    <span class="p">)</span>
    <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">initial_output</span>

    <span class="c1"># Run the main leximin optimization loop to fix agent probabilities</span>
    <span class="n">fixed_probabilities</span> <span class="o">=</span> <span class="n">_run_leximin_main_loop</span><span class="p">(</span><span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span><span class="p">,</span> <span class="n">committees</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">output_lines</span><span class="p">)</span>

    <span class="c1"># Convert fixed agent probabilities to committee probabilities</span>
    <span class="n">probabilities_normalised</span> <span class="o">=</span> <span class="n">_solve_leximin_primal_for_final_probabilities</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">fixed_probabilities</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">committees</span><span class="p">),</span> <span class="n">probabilities_normalised</span><span class="p">,</span> <span class="n">output_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.committee_generation.find_distribution_maximin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_distribution_maximin</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

<a href="#sortition_algorithms.committee_generation.find_distribution_maximin" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a distribution over feasible committees that maximizes the minimum probability of an agent being selected.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureCollection with min/max quotas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People object with pool members</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>desired size of the panel</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="sortition_algorithms.settings.Settings">Settings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings object containing configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple of (committees, probabilities, output_lines)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>committees: list of feasible committees (frozenset of agent IDs)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>probabilities: list of probabilities for each committee</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="float">float</span>], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>output_lines: list of debug strings</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/committee_generation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_distribution_maximin</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a distribution over feasible committees that maximizes the minimum probability of an agent being selected.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: FeatureCollection with min/max quotas</span>
<span class="sd">        people: People object with pool members</span>
<span class="sd">        number_people_wanted: desired size of the panel</span>
<span class="sd">        settings: Settings object containing configuration</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of (committees, probabilities, output_lines)</span>
<span class="sd">        - committees: list of feasible committees (frozenset of agent IDs)</span>
<span class="sd">        - probabilities: list of probabilities for each committee</span>
<span class="sd">        - output_lines: list of debug strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_ret</span><span class="p">(</span><span class="s2">&quot;Using maximin algorithm.&quot;</span><span class="p">)]</span>

    <span class="c1"># Set up an ILP that can be used for discovering new feasible committees</span>
    <span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span> <span class="o">=</span> <span class="n">_setup_committee_generation</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="c1"># Find initial committees that cover every possible agent</span>
    <span class="n">committees</span><span class="p">,</span> <span class="n">covered_agents</span><span class="p">,</span> <span class="n">initial_output</span> <span class="o">=</span> <span class="n">_generate_initial_committees</span><span class="p">(</span>
        <span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span><span class="p">,</span> <span class="n">people</span><span class="o">.</span><span class="n">count</span>
    <span class="p">)</span>
    <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">initial_output</span>

    <span class="c1"># Set up the incremental LP model for column generation</span>
    <span class="n">incremental_model</span><span class="p">,</span> <span class="n">incr_agent_vars</span><span class="p">,</span> <span class="n">upper_bound_var</span> <span class="o">=</span> <span class="n">_setup_maximin_incremental_model</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">covered_agents</span><span class="p">)</span>

    <span class="c1"># Run the main optimization loop</span>
    <span class="k">return</span> <span class="n">_run_maximin_optimization_loop</span><span class="p">(</span>
        <span class="n">new_committee_model</span><span class="p">,</span>
        <span class="n">agent_vars</span><span class="p">,</span>
        <span class="n">incremental_model</span><span class="p">,</span>
        <span class="n">incr_agent_vars</span><span class="p">,</span>
        <span class="n">upper_bound_var</span><span class="p">,</span>
        <span class="n">committees</span><span class="p">,</span>
        <span class="n">covered_agents</span><span class="p">,</span>
        <span class="n">output_lines</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.committee_generation.find_distribution_nash" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_distribution_nash</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

<a href="#sortition_algorithms.committee_generation.find_distribution_nash" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a distribution over feasible committees that maximizes the Nash welfare, i.e., the product of
selection probabilities over all persons.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureCollection with min/max quotas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People object with pool members</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>desired size of the panel</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="sortition_algorithms.settings.Settings">Settings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings object containing configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple of (committees, probabilities, output_lines)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>committees: list of feasible committees (frozenset of agent IDs)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>probabilities: list of probabilities for each committee</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="float">float</span>], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>output_lines: list of debug strings</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>The algorithm maximizes the product of selection probabilities Πᵢ pᵢ by equivalently maximizing
log(Πᵢ pᵢ) = Σᵢ log(pᵢ). If some person i is not included in any feasible committee, their pᵢ is 0, and
this sum is -∞. We maximize Σᵢ log(pᵢ) where i is restricted to range over persons that can possibly be included.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/committee_generation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_distribution_nash</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a distribution over feasible committees that maximizes the Nash welfare, i.e., the product of</span>
<span class="sd">    selection probabilities over all persons.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: FeatureCollection with min/max quotas</span>
<span class="sd">        people: People object with pool members</span>
<span class="sd">        number_people_wanted: desired size of the panel</span>
<span class="sd">        settings: Settings object containing configuration</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of (committees, probabilities, output_lines)</span>
<span class="sd">        - committees: list of feasible committees (frozenset of agent IDs)</span>
<span class="sd">        - probabilities: list of probabilities for each committee</span>
<span class="sd">        - output_lines: list of debug strings</span>

<span class="sd">    The algorithm maximizes the product of selection probabilities Πᵢ pᵢ by equivalently maximizing</span>
<span class="sd">    log(Πᵢ pᵢ) = Σᵢ log(pᵢ). If some person i is not included in any feasible committee, their pᵢ is 0, and</span>
<span class="sd">    this sum is -∞. We maximize Σᵢ log(pᵢ) where i is restricted to range over persons that can possibly be included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_ret</span><span class="p">(</span><span class="s2">&quot;Using Nash algorithm.&quot;</span><span class="p">)]</span>

    <span class="c1"># Set up an ILP used for discovering new feasible committees</span>
    <span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span> <span class="o">=</span> <span class="n">_setup_committee_generation</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="c1"># Find initial committees that include every possible agent</span>
    <span class="n">committee_set</span><span class="p">,</span> <span class="n">covered_agents</span><span class="p">,</span> <span class="n">initial_output</span> <span class="o">=</span> <span class="n">_generate_initial_committees</span><span class="p">(</span>
        <span class="n">new_committee_model</span><span class="p">,</span> <span class="n">agent_vars</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">people</span><span class="o">.</span><span class="n">count</span>
    <span class="p">)</span>
    <span class="n">committees</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">committee_set</span><span class="p">)</span>
    <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">initial_output</span>

    <span class="c1"># Map the covered agents to indices in a list for easier matrix representation</span>
    <span class="n">entitlements</span><span class="p">,</span> <span class="n">contributes_to_entitlement</span> <span class="o">=</span> <span class="n">_define_entitlements</span><span class="p">(</span><span class="n">covered_agents</span><span class="p">)</span>

    <span class="c1"># Run the main Nash welfare optimization loop</span>
    <span class="k">return</span> <span class="n">_run_nash_optimization_loop</span><span class="p">(</span>
        <span class="n">new_committee_model</span><span class="p">,</span>
        <span class="n">agent_vars</span><span class="p">,</span>
        <span class="n">committees</span><span class="p">,</span>
        <span class="n">entitlements</span><span class="p">,</span>
        <span class="n">contributes_to_entitlement</span><span class="p">,</span>
        <span class="n">covered_agents</span><span class="p">,</span>
        <span class="n">number_people_wanted</span><span class="p">,</span>
        <span class="n">output_lines</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.committee_generation.standardize_distribution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">standardize_distribution</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span></code>

<a href="#sortition_algorithms.committee_generation.standardize_distribution" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Remove committees with zero probability and renormalize.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>committees</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of committees</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probabilities</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>corresponding probabilities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple of (filtered_committees, normalized_probabilities)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/committee_generation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">standardize_distribution</span><span class="p">(</span>
    <span class="n">committees</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">probabilities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove committees with zero probability and renormalize.</span>

<span class="sd">    Args:</span>
<span class="sd">        committees: list of committees</span>
<span class="sd">        probabilities: corresponding probabilities</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of (filtered_committees, normalized_probabilities)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">committees</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span>
    <span class="n">new_committees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_probabilities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">committee</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="n">EPS2</span><span class="p">:</span>
            <span class="n">new_committees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">committee</span><span class="p">)</span>
            <span class="n">new_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
    <span class="n">prob_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">new_probabilities</span><span class="p">)</span>
    <span class="n">new_probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">prob</span> <span class="o">/</span> <span class="n">prob_sum</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">new_probabilities</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_committees</span><span class="p">,</span> <span class="n">new_probabilities</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.core"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.core.find_random_sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_random_sample</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">selection_algorithm</span><span class="o">=</span><span class="s1">&#39;maximin&#39;</span><span class="p">,</span> <span class="n">test_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">number_selections</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#sortition_algorithms.core.find_random_sample" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Main algorithm to find one or multiple random committees.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureCollection with min/max quotas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People object with pool members</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>desired size of the panel</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="sortition_algorithms.settings.Settings">Settings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings object containing configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selection_algorithm</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one of "legacy", "maximin", "leximin", or "nash"</p>
              </div>
            </td>
            <td>
                  <code>&#39;maximin&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_selection</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if set, do not do a random selection, but just return some valid panel.
Useful for quickly testing whether quotas are satisfiable, but should always be false for actual selection!</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_selections</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how many panels to return. Most of the time, this should be set to 1, which means that
a single panel is chosen. When specifying a value n ≥ 2, the function will return a list of length n,
containing multiple panels (some panels might be repeated in the list). In this case the eventual panel
should be drawn uniformly at random from the returned list.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple of (committee_lottery, output_lines)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>committee_lottery: list of committees, where each committee is a frozen set of pool member ids</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>output_lines: list of debug strings</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="InfeasibleQuotasError">InfeasibleQuotasError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the quotas cannot be satisfied, which includes a suggestion for how to modify them</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SelectionError">SelectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in multiple other failure cases</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>for invalid parameters</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if required solver is not available</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_random_sample</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
    <span class="n">selection_algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximin&quot;</span><span class="p">,</span>
    <span class="n">test_selection</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">number_selections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main algorithm to find one or multiple random committees.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: FeatureCollection with min/max quotas</span>
<span class="sd">        people: People object with pool members</span>
<span class="sd">        number_people_wanted: desired size of the panel</span>
<span class="sd">        settings: Settings object containing configuration</span>
<span class="sd">        selection_algorithm: one of &quot;legacy&quot;, &quot;maximin&quot;, &quot;leximin&quot;, or &quot;nash&quot;</span>
<span class="sd">        test_selection: if set, do not do a random selection, but just return some valid panel.</span>
<span class="sd">            Useful for quickly testing whether quotas are satisfiable, but should always be false for actual selection!</span>
<span class="sd">        number_selections: how many panels to return. Most of the time, this should be set to 1, which means that</span>
<span class="sd">            a single panel is chosen. When specifying a value n ≥ 2, the function will return a list of length n,</span>
<span class="sd">            containing multiple panels (some panels might be repeated in the list). In this case the eventual panel</span>
<span class="sd">            should be drawn uniformly at random from the returned list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of (committee_lottery, output_lines)</span>
<span class="sd">        - committee_lottery: list of committees, where each committee is a frozen set of pool member ids</span>
<span class="sd">        - output_lines: list of debug strings</span>

<span class="sd">    Raises:</span>
<span class="sd">        InfeasibleQuotasError: if the quotas cannot be satisfied, which includes a suggestion for how to modify them</span>
<span class="sd">        SelectionError: in multiple other failure cases</span>
<span class="sd">        ValueError: for invalid parameters</span>
<span class="sd">        RuntimeError: if required solver is not available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="k">if</span> <span class="n">test_selection</span> <span class="ow">and</span> <span class="n">number_selections</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Running the test selection does not support generating a transparent lottery, so, if &quot;</span>
            <span class="s2">&quot;`test_selection` is true, `number_selections` must be 1.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">selection_algorithm</span> <span class="o">==</span> <span class="s2">&quot;legacy&quot;</span> <span class="ow">and</span> <span class="n">number_selections</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Currently, the legacy algorithm does not support generating a transparent lottery, &quot;</span>
            <span class="s2">&quot;so `number_selections` must be set to 1.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Quick test selection using find_any_committee</span>
    <span class="k">if</span> <span class="n">test_selection</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running test selection.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">find_any_committee</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Check if Gurobi is available for leximin</span>
    <span class="k">if</span> <span class="n">selection_algorithm</span> <span class="o">==</span> <span class="s2">&quot;leximin&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">GUROBI_AVAILABLE</span><span class="p">:</span>
        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">print_ret</span><span class="p">(</span>
                <span class="s2">&quot;The leximin algorithm requires the optimization library Gurobi to be installed &quot;</span>
                <span class="s2">&quot;(commercial, free academic licenses available). Switching to the simpler &quot;</span>
                <span class="s2">&quot;maximin algorithm, which can be run using open source solvers.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">selection_algorithm</span> <span class="o">=</span> <span class="s2">&quot;maximin&quot;</span>

    <span class="c1"># Route to appropriate algorithm</span>
    <span class="k">if</span> <span class="n">selection_algorithm</span> <span class="o">==</span> <span class="s2">&quot;legacy&quot;</span><span class="p">:</span>
        <span class="c1"># Import here to avoid circular imports</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sortition_algorithms.find_sample</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_random_sample_legacy</span>

        <span class="k">return</span> <span class="n">find_random_sample_legacy</span><span class="p">(</span>
            <span class="n">people</span><span class="p">,</span>
            <span class="n">features</span><span class="p">,</span>
            <span class="n">number_people_wanted</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">check_same_address</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">selection_algorithm</span> <span class="o">==</span> <span class="s2">&quot;leximin&quot;</span><span class="p">:</span>
        <span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">new_output_lines</span> <span class="o">=</span> <span class="n">find_distribution_leximin</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">selection_algorithm</span> <span class="o">==</span> <span class="s2">&quot;maximin&quot;</span><span class="p">:</span>
        <span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">new_output_lines</span> <span class="o">=</span> <span class="n">find_distribution_maximin</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">selection_algorithm</span> <span class="o">==</span> <span class="s2">&quot;nash&quot;</span><span class="p">:</span>
        <span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">new_output_lines</span> <span class="o">=</span> <span class="n">find_distribution_nash</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown selection algorithm </span><span class="si">{</span><span class="n">selection_algorithm</span><span class="si">!r}</span><span class="s2">, must be either &#39;legacy&#39;, &#39;leximin&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;maximin&#39;, or &#39;nash&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Post-process the distribution</span>
    <span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">standardize_distribution</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">committees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">people</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;INFO: The distribution over panels is what is known as a &#39;basic solution&#39;. There is no reason for concern &quot;</span>
            <span class="s2">&quot;about the correctness of your output, but we&#39;d appreciate if you could reach out to panelot&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;@paulgoelz.de with the following information: algorithm=</span><span class="si">{</span><span class="n">selection_algorithm</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;num_panels=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">committees</span><span class="p">)</span><span class="si">}</span><span class="s2">, num_agents=</span><span class="si">{</span><span class="n">people</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">, min_probs=</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">committees</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">committees</span><span class="p">)</span>

    <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">new_output_lines</span>
    <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">_distribution_stats</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span>

    <span class="c1"># Convert to lottery</span>
    <span class="n">committee_lottery</span> <span class="o">=</span> <span class="n">lottery_rounding</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">number_selections</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">committee_lottery</span><span class="p">,</span> <span class="n">output_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.core.lottery_rounding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lottery_rounding</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">number_selections</span><span class="p">)</span></code>

<a href="#sortition_algorithms.core.lottery_rounding" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Convert probability distribution over committees to a discrete lottery.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>committees</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of committees</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probabilities</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>corresponding probabilities (must sum to 1)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_selections</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of committees to return</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of committees (may contain duplicates) of length number_selections</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lottery_rounding</span><span class="p">(</span>
    <span class="n">committees</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">probabilities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">number_selections</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert probability distribution over committees to a discrete lottery.</span>

<span class="sd">    Args:</span>
<span class="sd">        committees: list of committees</span>
<span class="sd">        probabilities: corresponding probabilities (must sum to 1)</span>
<span class="sd">        number_selections: number of committees to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of committees (may contain duplicates) of length number_selections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">committees</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">number_selections</span> <span class="o">&gt;=</span> <span class="mi">1</span>

    <span class="n">num_copies</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">residuals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">scaled_prob</span> <span class="o">=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">number_selections</span>
        <span class="n">num_copies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">scaled_prob</span><span class="p">))</span>  <span class="c1"># give lower quotas</span>
        <span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scaled_prob</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">scaled_prob</span><span class="p">))</span>

    <span class="n">rounded_up_indices</span> <span class="o">=</span> <span class="n">pipage_rounding</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">residuals</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">committee_index</span> <span class="ow">in</span> <span class="n">rounded_up_indices</span><span class="p">:</span>
        <span class="n">num_copies</span><span class="p">[</span><span class="n">committee_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">committee_lottery</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">committee</span><span class="p">,</span> <span class="n">committee_copies</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">committees</span><span class="p">,</span> <span class="n">num_copies</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">committee_lottery</span> <span class="o">+=</span> <span class="p">[</span><span class="n">committee</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">committee_copies</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">committee_lottery</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.core.pipage_rounding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pipage_rounding</span><span class="p">(</span><span class="n">marginals</span><span class="p">)</span></code>

<a href="#sortition_algorithms.core.pipage_rounding" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Pipage rounding algorithm for converting fractional solutions to integer solutions.</p>
<p>Takes a list of (object, probability) pairs and randomly rounds them to a set of objects
such that the expected number of times each object appears equals its probability.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>marginals</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="int">int</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of (object, probability) pairs where probabilities sum to an integer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of objects that were selected</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pipage_rounding</span><span class="p">(</span><span class="n">marginals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pipage rounding algorithm for converting fractional solutions to integer solutions.</span>

<span class="sd">    Takes a list of (object, probability) pairs and randomly rounds them to a set of objects</span>
<span class="sd">    such that the expected number of times each object appears equals its probability.</span>

<span class="sd">    Args:</span>
<span class="sd">        marginals: list of (object, probability) pairs where probabilities sum to an integer</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of objects that were selected</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">marginals</span><span class="p">)</span>

    <span class="n">outcomes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">marginals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">outcomes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">marginals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">obj</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">random_provider</span><span class="p">()</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">prob</span><span class="p">:</span>
                <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">marginals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj0</span><span class="p">,</span> <span class="n">prob0</span> <span class="o">=</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">prob0</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">EPS2</span><span class="p">:</span>
                <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj0</span><span class="p">)</span>
                <span class="n">marginals</span> <span class="o">=</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">prob0</span> <span class="o">&lt;</span> <span class="n">EPS2</span><span class="p">:</span>
                <span class="n">marginals</span> <span class="o">=</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">continue</span>

            <span class="n">obj1</span><span class="p">,</span> <span class="n">prob1</span> <span class="o">=</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">prob1</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">EPS2</span><span class="p">:</span>
                <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span>
                <span class="n">marginals</span> <span class="o">=</span> <span class="p">[</span><span class="n">marginals</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">prob1</span> <span class="o">&lt;</span> <span class="n">EPS2</span><span class="p">:</span>
                <span class="n">marginals</span> <span class="o">=</span> <span class="p">[</span><span class="n">marginals</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">continue</span>

            <span class="n">inc0_dec1_amount</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="mf">1.0</span> <span class="o">-</span> <span class="n">prob0</span><span class="p">,</span> <span class="n">prob1</span>
            <span class="p">)</span>  <span class="c1"># maximal amount that prob0 can be increased and prob1 can be decreased</span>
            <span class="n">dec0_inc1_amount</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">prob0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">prob1</span><span class="p">)</span>
            <span class="n">choice_probability</span> <span class="o">=</span> <span class="n">dec0_inc1_amount</span> <span class="o">/</span> <span class="p">(</span><span class="n">inc0_dec1_amount</span> <span class="o">+</span> <span class="n">dec0_inc1_amount</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">random_provider</span><span class="p">()</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">choice_probability</span><span class="p">:</span>  <span class="c1"># increase prob0 and decrease prob1</span>
                <span class="n">prob0</span> <span class="o">+=</span> <span class="n">inc0_dec1_amount</span>
                <span class="n">prob1</span> <span class="o">-=</span> <span class="n">inc0_dec1_amount</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prob0</span> <span class="o">-=</span> <span class="n">dec0_inc1_amount</span>
                <span class="n">prob1</span> <span class="o">+=</span> <span class="n">dec0_inc1_amount</span>
            <span class="n">marginals</span> <span class="o">=</span> <span class="p">[(</span><span class="n">obj0</span><span class="p">,</span> <span class="n">prob0</span><span class="p">),</span> <span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">prob1</span><span class="p">)]</span> <span class="o">+</span> <span class="n">marginals</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.core.run_stratification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_stratification</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">test_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">number_selections</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#sortition_algorithms.core.run_stratification" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Run stratified random selection with retry logic.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FeatureCollection with min/max quotas for each feature value</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People object containing the pool of candidates</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired size of the panel</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><span title="sortition_algorithms.settings.Settings">Settings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings object containing configuration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_selection</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, don't randomize (for testing only)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_selections</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of panels to return</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (success, selected_committees, output_lines)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>success: Whether selection succeeded within max attempts</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>selected_committees: List of committees (frozensets of person IDs)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="bool">bool</span>, <span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>output_lines: Debug and status messages</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If number_people_wanted is outside valid range for any feature</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For invalid parameters</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required solver is not available</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="InfeasibleQuotasError">InfeasibleQuotasError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If quotas cannot be satisfied</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_stratification</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
    <span class="n">test_selection</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">number_selections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run stratified random selection with retry logic.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: FeatureCollection with min/max quotas for each feature value</span>
<span class="sd">        people: People object containing the pool of candidates</span>
<span class="sd">        number_people_wanted: Desired size of the panel</span>
<span class="sd">        settings: Settings object containing configuration</span>
<span class="sd">        test_selection: If True, don&#39;t randomize (for testing only)</span>
<span class="sd">        number_selections: Number of panels to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success, selected_committees, output_lines)</span>
<span class="sd">        - success: Whether selection succeeded within max attempts</span>
<span class="sd">        - selected_committees: List of committees (frozensets of person IDs)</span>
<span class="sd">        - output_lines: Debug and status messages</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If number_people_wanted is outside valid range for any feature</span>
<span class="sd">        ValueError: For invalid parameters</span>
<span class="sd">        RuntimeError: If required solver is not available</span>
<span class="sd">        InfeasibleQuotasError: If quotas cannot be satisfied</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if desired number is within feature constraints</span>
    <span class="n">features</span><span class="o">.</span><span class="n">check_desired</span><span class="p">(</span><span class="n">number_people_wanted</span><span class="p">)</span>

    <span class="c1"># Set random seed if specified</span>
    <span class="c1"># If the seed is zero or None, we use the secrets module, as it is better</span>
    <span class="c1"># from a security point of view</span>
    <span class="n">set_random_provider</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">random_number_seed</span><span class="p">)</span>

    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">test_selection</span><span class="p">:</span>
        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;&lt;b style=&#39;color: red&#39;&gt;WARNING: Panel is not selected at random! Only use for testing!&lt;/b&gt;&lt;br&gt;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Initial: (selected = 0)&lt;/b&gt;&quot;</span><span class="p">)</span>
    <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">_initial_print_category_info</span><span class="p">(</span>
        <span class="n">features</span><span class="p">,</span>
        <span class="n">people</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">people_selected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tries</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">max_attempts</span><span class="p">):</span>
        <span class="n">people_selected</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;Trial number: </span><span class="si">{</span><span class="n">tries</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">people_selected</span><span class="p">,</span> <span class="n">new_output_lines</span> <span class="o">=</span> <span class="n">find_random_sample</span><span class="p">(</span>
                <span class="n">features</span><span class="p">,</span>
                <span class="n">people</span><span class="p">,</span>
                <span class="n">number_people_wanted</span><span class="p">,</span>
                <span class="n">settings</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">selection_algorithm</span><span class="p">,</span>
                <span class="n">test_selection</span><span class="p">,</span>
                <span class="n">number_selections</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">new_output_lines</span>

            <span class="c1"># Check if targets were met (only works for number_selections = 1)</span>
            <span class="n">new_output_lines</span> <span class="o">=</span> <span class="n">_print_category_info</span><span class="p">(</span>
                <span class="n">features</span><span class="p">,</span>
                <span class="n">people</span><span class="p">,</span>
                <span class="n">people_selected</span><span class="p">,</span>
                <span class="n">number_people_wanted</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">check_output_lines</span> <span class="o">=</span> <span class="n">_check_category_selected</span><span class="p">(</span>
                <span class="n">features</span><span class="p">,</span>
                <span class="n">people</span><span class="p">,</span>
                <span class="n">people_selected</span><span class="p">,</span>
                <span class="n">number_selections</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;SUCCESS!!&lt;/b&gt; Final:&quot;</span><span class="p">)</span>
                <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">new_output_lines</span> <span class="o">+</span> <span class="n">check_output_lines</span>
                <span class="k">break</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">InfeasibleQuotasError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">output_lines</span> <span class="o">+=</span> <span class="n">err</span><span class="o">.</span><span class="n">output</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span> <span class="k">as</span> <span class="n">serr</span><span class="p">:</span>
            <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: Selection Error thrown: </span><span class="si">{</span><span class="n">serr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed </span><span class="si">{</span><span class="n">tries</span><span class="si">}</span><span class="s2"> times... gave up.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">people_selected</span><span class="p">,</span> <span class="n">output_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.core.selected_remaining_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">selected_remaining_tables</span><span class="p">(</span><span class="n">full_people</span><span class="p">,</span> <span class="n">people_selected</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

<a href="#sortition_algorithms.core.selected_remaining_tables" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>write some text</p>
<p>people_selected is a single frozenset[str] - it must be unwrapped before being passed
to this function.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">selected_remaining_tables</span><span class="p">(</span>
    <span class="n">full_people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">people_selected</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    write some text</span>

<span class="sd">    people_selected is a single frozenset[str] - it must be unwrapped before being passed</span>
<span class="sd">    to this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">people_working</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">full_people</span><span class="p">)</span>
    <span class="n">output_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">people_selected_rows</span> <span class="o">=</span> <span class="n">person_list_to_table</span><span class="p">(</span><span class="n">people_selected</span><span class="p">,</span> <span class="n">people_working</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="c1"># now delete the selected people (and maybe also those at the same address)</span>
    <span class="n">num_same_address_deleted</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pkey</span> <span class="ow">in</span> <span class="n">people_selected</span><span class="p">:</span>
        <span class="c1"># if check address then delete all those at this address (will NOT delete the one we want as well)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">check_same_address</span><span class="p">:</span>
            <span class="n">pkey_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">people_working</span><span class="o">.</span><span class="n">matching_address</span><span class="p">(</span><span class="n">pkey</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">))</span>
            <span class="n">num_same_address_deleted</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkey_to_delete</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># then delete this/these people at the same address from the reserve/remaining pool</span>
            <span class="n">people_working</span><span class="o">.</span><span class="n">remove_many</span><span class="p">([</span><span class="n">pkey</span><span class="p">,</span> <span class="o">*</span><span class="n">pkey_to_delete</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">people_working</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pkey</span><span class="p">)</span>

    <span class="c1"># add the columns to keep into remaining people</span>
    <span class="c1"># as above all these values are all in people_working but this is tidier...</span>
    <span class="n">people_remaining_rows</span> <span class="o">=</span> <span class="n">person_list_to_table</span><span class="p">(</span><span class="n">people_working</span><span class="p">,</span> <span class="n">people_working</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">people_selected_rows</span><span class="p">,</span> <span class="n">people_remaining_rows</span><span class="p">,</span> <span class="n">output_lines</span>

    <span class="c1"># TODO: put this code somewhere more suitable</span>
    <span class="c1"># maybe in strat app only?</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dupes = self._output_selected_remaining(</span>
<span class="sd">        settings,</span>
<span class="sd">        people_selected_rows,</span>
<span class="sd">        people_remaining_rows,</span>
<span class="sd">    )</span>
<span class="sd">    if settings.check_same_address and self.gen_rem_tab == &quot;on&quot;:</span>
<span class="sd">        output_lines.append(</span>
<span class="sd">            f&quot;Deleted {num_same_address_deleted} people from remaining file who had the same &quot;</span>
<span class="sd">            f&quot;address as selected people.&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        m = min(30, len(dupes))</span>
<span class="sd">        output_lines.append(</span>
<span class="sd">            f&quot;In the remaining tab there are {len(dupes)} people who share the same address as &quot;</span>
<span class="sd">            f&quot;someone else in the tab. We highlighted the first {m} of these. &quot;</span>
<span class="sd">            f&quot;The full list of lines is {dupes}&quot;,</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.errors"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.features"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.features.FeatureCollection" class="doc doc-heading">
            <code>FeatureCollection</code>


<a href="#sortition_algorithms.features.FeatureCollection" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A full set of features for a stratification.</p>
<p>The keys here are the names of the features. They could be: gender, age_bracket, education_level etc</p>
<p>The values are FeatureValues objects - the breakdown of the values for a feature.</p>







              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FeatureCollection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full set of features for a stratification.</span>

<span class="sd">    The keys here are the names of the features. They could be: gender, age_bracket, education_level etc</span>

<span class="sd">    The values are FeatureValues objects - the breakdown of the values for a feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: consider splitting the updates/remaining into a parallel set of classes</span>
    <span class="c1"># then this can just have targets, and the running totals can be in classes we can</span>
    <span class="c1"># regenerate now and then</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FeatureValues</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">FeatureValues</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">collection</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fv_counts</span><span class="p">:</span> <span class="n">FeatureValueCounts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">add_value_counts</span><span class="p">(</span><span class="n">value_name</span><span class="p">,</span> <span class="n">fv_counts</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">feature_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">feature_values_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">FeatureValueCounts</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">value_counts</span> <span class="ow">in</span> <span class="n">feature_values</span><span class="o">.</span><span class="n">values_counts</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">value_counts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_safe_max_flex_val</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># to avoid errors, if max_flex is not set we must set it at least as high as the highest</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_default_max_flex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Note this only sets it if left at the default value&quot;&quot;&quot;</span>
        <span class="n">max_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_max_flex_val</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">feature_values</span><span class="o">.</span><span class="n">set_default_max_flex</span><span class="p">(</span><span class="n">max_flex</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">add_remaining</span><span class="p">(</span><span class="n">value_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">add_selected</span><span class="p">(</span><span class="n">value_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">value_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed removing from </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">value_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">minimum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The minimum selection for this set of features is the largest minimum selection</span>
<span class="sd">        of any individual feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">maximum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum selection for this set of features is the smallest maximum selection</span>
<span class="sd">        of any individual feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the min is bigger than the max we&#39;re in trouble i.e. there&#39;s an input error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Inconsistent numbers in min and max in the features input: the sum &quot;</span>
                <span class="s2">&quot;of the minimum values of a features is larger than the sum of the &quot;</span>
                <span class="s2">&quot;maximum values of a(nother) feature. &quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_desired</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the desired number of people is within the min/max of every feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">desired_number</span> <span class="o">&lt;</span> <span class="n">feature_values</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span>
                <span class="ow">or</span> <span class="n">desired_number</span> <span class="o">&gt;</span> <span class="n">feature_values</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The number of people to select (</span><span class="si">{</span><span class="n">desired_number</span><span class="si">}</span><span class="s2">) is out of the range of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the numbers of people in the </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> feature. It should be within &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">feature_values</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">feature_values</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span><span class="si">}</span><span class="s2">].&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureCollection.check_desired" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_desired</span><span class="p">(</span><span class="n">desired_number</span><span class="p">)</span></code>

<a href="#sortition_algorithms.features.FeatureCollection.check_desired" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check if the desired number of people is within the min/max of every feature.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_desired</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the desired number of people is within the min/max of every feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">desired_number</span> <span class="o">&lt;</span> <span class="n">feature_values</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span>
            <span class="ow">or</span> <span class="n">desired_number</span> <span class="o">&gt;</span> <span class="n">feature_values</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The number of people to select (</span><span class="si">{</span><span class="n">desired_number</span><span class="si">}</span><span class="s2">) is out of the range of &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the numbers of people in the </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> feature. It should be within &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">feature_values</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">feature_values</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span><span class="si">}</span><span class="s2">].&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureCollection.check_min_max" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_min_max</span><span class="p">()</span></code>

<a href="#sortition_algorithms.features.FeatureCollection.check_min_max" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>If the min is bigger than the max we're in trouble i.e. there's an input error</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If the min is bigger than the max we&#39;re in trouble i.e. there&#39;s an input error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Inconsistent numbers in min and max in the features input: the sum &quot;</span>
            <span class="s2">&quot;of the minimum values of a features is larger than the sum of the &quot;</span>
            <span class="s2">&quot;maximum values of a(nother) feature. &quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureCollection.maximum_selection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">maximum_selection</span><span class="p">()</span></code>

<a href="#sortition_algorithms.features.FeatureCollection.maximum_selection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>The maximum selection for this set of features is the smallest maximum selection
of any individual feature.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">maximum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The maximum selection for this set of features is the smallest maximum selection</span>
<span class="sd">    of any individual feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">maximum_selection</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureCollection.minimum_selection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">minimum_selection</span><span class="p">()</span></code>

<a href="#sortition_algorithms.features.FeatureCollection.minimum_selection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>The minimum selection for this set of features is the largest minimum selection
of any individual feature.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">minimum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The minimum selection for this set of features is the largest minimum selection</span>
<span class="sd">    of any individual feature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">minimum_selection</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureCollection.set_default_max_flex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_default_max_flex</span><span class="p">()</span></code>

<a href="#sortition_algorithms.features.FeatureCollection.set_default_max_flex" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Note this only sets it if left at the default value</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_default_max_flex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Note this only sets it if left at the default value&quot;&quot;&quot;</span>
    <span class="n">max_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_max_flex_val</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">feature_values</span><span class="o">.</span><span class="n">set_default_max_flex</span><span class="p">(</span><span class="n">max_flex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.features.FeatureValues" class="doc doc-heading">
            <code>FeatureValues</code>


<a href="#sortition_algorithms.features.FeatureValues" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A full set of values for a single feature.</p>
<p>If the feature is gender, the values could be: male, female, non_binary_other</p>
<p>The values are FeatureValueCounts objects - the min, max and current counts of the
selected people in that feature value.</p>







              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FeatureValues</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full set of values for a single feature.</span>

<span class="sd">    If the feature is gender, the values could be: male, female, non_binary_other</span>

<span class="sd">    The values are FeatureValueCounts objects - the min, max and current counts of the</span>
<span class="sd">    selected people in that feature value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FeatureValueCounts</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">feature_values</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_value_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fv_counts</span><span class="p">:</span> <span class="n">FeatureValueCounts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">value_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fv_counts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_default_max_flex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_flex</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Note this only sets it if left at the default value&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fv_counts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">fv_counts</span><span class="o">.</span><span class="n">set_default_max_flex</span><span class="p">(</span><span class="n">max_flex</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">values_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FeatureValueCounts</span><span class="p">]]:</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">value_name</span><span class="p">]</span><span class="o">.</span><span class="n">add_remaining</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">value_name</span><span class="p">]</span><span class="o">.</span><span class="n">add_selected</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="p">[</span><span class="n">value_name</span><span class="p">]</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">minimum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For this feature, we have to select at least the sum of the minimum of each value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">min</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">maximum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For this feature, we have to select at most the sum of the maximum of each value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">max</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureValues.maximum_selection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">maximum_selection</span><span class="p">()</span></code>

<a href="#sortition_algorithms.features.FeatureValues.maximum_selection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>For this feature, we have to select at most the sum of the maximum of each value</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">maximum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For this feature, we have to select at most the sum of the maximum of each value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">max</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureValues.minimum_selection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">minimum_selection</span><span class="p">()</span></code>

<a href="#sortition_algorithms.features.FeatureValues.minimum_selection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>For this feature, we have to select at least the sum of the minimum of each value</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">minimum_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For this feature, we have to select at least the sum of the minimum of each value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">min</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.features.FeatureValues.set_default_max_flex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_default_max_flex</span><span class="p">(</span><span class="n">max_flex</span><span class="p">)</span></code>

<a href="#sortition_algorithms.features.FeatureValues.set_default_max_flex" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Note this only sets it if left at the default value</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_default_max_flex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_flex</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Note this only sets it if left at the default value&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fv_counts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_values</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">fv_counts</span><span class="o">.</span><span class="n">set_default_max_flex</span><span class="p">(</span><span class="n">max_flex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.features.read_in_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_in_features</span><span class="p">(</span><span class="n">features_head</span><span class="p">,</span> <span class="n">features_body</span><span class="p">)</span></code>

<a href="#sortition_algorithms.features.read_in_features" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Read in stratified selection features and values</p>
<p>Note we do want features_head to ensure we don't have multiple columns with the same name</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_in_features</span><span class="p">(</span>
    <span class="n">features_head</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">features_body</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">FeatureCollection</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in stratified selection features and values</span>

<span class="sd">    Note we do want features_head to ensure we don&#39;t have multiple columns with the same name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">FeatureCollection</span><span class="p">()</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">features_flex</span><span class="p">,</span> <span class="n">filtered_headers</span> <span class="o">=</span> <span class="n">_feature_headers_flex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">features_head</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">features_body</span><span class="p">:</span>
        <span class="c1"># check the set of keys in the row are the same as the headers</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtered_headers</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">stripped_row</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">StrippedDict</span><span class="p">(</span><span class="n">_normalise_col_names</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped_row</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="n">features</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="o">*</span><span class="n">_clean_row</span><span class="p">(</span><span class="n">stripped_row</span><span class="p">,</span> <span class="n">features_flex</span><span class="p">))</span>

    <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">features</span><span class="o">.</span><span class="n">check_min_max</span><span class="p">()</span>
    <span class="c1"># check feature_flex to see if we need to set the max here</span>
    <span class="c1"># this only changes the max_flex value if these (optional) flex values are NOT set already</span>
    <span class="n">features</span><span class="o">.</span><span class="n">set_default_max_flex</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">features</span><span class="p">,</span> <span class="n">msg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.find_sample"></a>
    <div class="doc doc-contents first">

        <p>Selection algorithms for stratified sampling.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.find_sample.find_random_sample_legacy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_random_sample_legacy</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">number_people_wanted</span><span class="p">,</span> <span class="n">check_same_address</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_same_address_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#sortition_algorithms.find_sample.find_random_sample_legacy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Legacy stratified random selection algorithm.</p>
<p>Implements the original algorithm that uses greedy selection based on priority ratios.
Always selects from the most urgently needed category first (highest ratio of
(min-selected)/remaining), then randomly picks within that category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>people</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="People (sortition_algorithms.people.People)" href="#sortition_algorithms.people.People">People</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>People collection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FeatureCollection (sortition_algorithms.features.FeatureCollection)" href="#sortition_algorithms.features.FeatureCollection">FeatureCollection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature definitions with min/max targets</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_people_wanted</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of people to select</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check_same_address</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to remove household members when selecting someone</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check_same_address_columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Address columns for household identification</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (selected_committees, output_messages) where:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>selected_committees: List containing one frozenset of selected person IDs</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="frozenset">frozenset</span>[<span title="str">str</span>]], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>output_messages: List of log messages about the selection process</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SelectionError">SelectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If selection becomes impossible (not enough people, etc.)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/find_sample.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_random_sample_legacy</span><span class="p">(</span>
    <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
    <span class="n">number_people_wanted</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">check_same_address</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">check_same_address_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Legacy stratified random selection algorithm.</span>

<span class="sd">    Implements the original algorithm that uses greedy selection based on priority ratios.</span>
<span class="sd">    Always selects from the most urgently needed category first (highest ratio of</span>
<span class="sd">    (min-selected)/remaining), then randomly picks within that category.</span>

<span class="sd">    Args:</span>
<span class="sd">        people: People collection</span>
<span class="sd">        features: Feature definitions with min/max targets</span>
<span class="sd">        number_people_wanted: Number of people to select</span>
<span class="sd">        check_same_address: Whether to remove household members when selecting someone</span>
<span class="sd">        check_same_address_columns: Address columns for household identification</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (selected_committees, output_messages) where:</span>
<span class="sd">        - selected_committees: List containing one frozenset of selected person IDs</span>
<span class="sd">        - output_messages: List of log messages about the selection process</span>

<span class="sd">    Raises:</span>
<span class="sd">        SelectionError: If selection becomes impossible (not enough people, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Using legacy algorithm.&quot;</span><span class="p">]</span>
    <span class="n">people_selected</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># Create PeopleFeatures and initialize</span>
    <span class="n">people_features</span> <span class="o">=</span> <span class="n">PeopleFeatures</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">check_same_address</span><span class="p">,</span> <span class="n">check_same_address_columns</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="n">people_features</span><span class="o">.</span><span class="n">update_all_features_remaining</span><span class="p">()</span>
    <span class="n">people_features</span><span class="o">.</span><span class="n">prune_for_feature_max_0</span><span class="p">()</span>

    <span class="c1"># Main selection loop</span>
    <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_people_wanted</span><span class="p">):</span>
        <span class="c1"># Find the category with highest priority ratio</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ratio_result</span> <span class="o">=</span> <span class="n">people_features</span><span class="o">.</span><span class="n">find_max_ratio_category</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Selection failed on iteration </span><span class="si">{</span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Find the randomly selected person within that category</span>
        <span class="n">target_feature</span> <span class="o">=</span> <span class="n">ratio_result</span><span class="o">.</span><span class="n">feature_name</span>
        <span class="n">target_value</span> <span class="o">=</span> <span class="n">ratio_result</span><span class="o">.</span><span class="n">feature_value</span>
        <span class="n">random_position</span> <span class="o">=</span> <span class="n">ratio_result</span><span class="o">.</span><span class="n">random_person_index</span>

        <span class="n">selected_person_key</span> <span class="o">=</span> <span class="n">people_features</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">find_person_by_position_in_category</span><span class="p">(</span>
            <span class="n">target_feature</span><span class="p">,</span> <span class="n">target_value</span><span class="p">,</span> <span class="n">random_position</span>
        <span class="p">)</span>

        <span class="c1"># Should never select the same person twice</span>
        <span class="k">assert</span> <span class="n">selected_person_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">people_selected</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">selected_person_key</span><span class="si">}</span><span class="s2"> was already selected&quot;</span>

        <span class="c1"># Select the person (this also removes household members if configured)</span>
        <span class="n">people_selected</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">selected_person_key</span><span class="p">)</span>
        <span class="n">selected_person_data</span> <span class="o">=</span> <span class="n">people_features</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">selected_person_key</span><span class="p">)</span>
        <span class="n">household_members_removed</span> <span class="o">=</span> <span class="n">people_features</span><span class="o">.</span><span class="n">select_person</span><span class="p">(</span><span class="n">selected_person_key</span><span class="p">)</span>

        <span class="c1"># Add output messages about household member removal</span>
        <span class="k">if</span> <span class="n">household_members_removed</span><span class="p">:</span>
            <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="n">selected_person_key</span><span class="si">}</span><span class="s2">, also removed household members: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">household_members_removed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Handle any categories that are now full after this selection</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">category_messages</span> <span class="o">=</span> <span class="n">people_features</span><span class="o">.</span><span class="n">handle_category_full_deletions</span><span class="p">(</span><span class="n">selected_person_data</span><span class="p">)</span>
            <span class="n">output_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">category_messages</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Selection failed after selecting </span><span class="si">{</span><span class="n">selected_person_key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Check if we&#39;re about to run out of people (but not on the last iteration)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">number_people_wanted</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">people_features</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Selection failed: Ran out of people before completing selection&quot;</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Return in legacy format: list containing single frozenset</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">people_selected</span><span class="p">)],</span> <span class="n">output_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.people_features"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.people_features.MaxRatioResult" class="doc doc-heading">
            <code>MaxRatioResult</code>


<a href="#sortition_algorithms.people_features.MaxRatioResult" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Result from finding the category with maximum selection ratio.</p>







              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@define</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MaxRatioResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result from finding the category with maximum selection ratio.&quot;&quot;&quot;</span>

    <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">feature_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">random_person_index</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.people_features.PeopleFeatures" class="doc doc-heading">
            <code>PeopleFeatures</code>


<a href="#sortition_algorithms.people_features.PeopleFeatures" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>This class manipulates people and features together, making a deepcopy on init.</p>







              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PeopleFeatures</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class manipulates people and features together, making a deepcopy on init.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: consider naming: maybe SelectionState</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">,</span>
        <span class="n">check_same_address</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">check_same_address_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">people</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address</span> <span class="o">=</span> <span class="n">check_same_address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address_columns</span> <span class="o">=</span> <span class="n">check_same_address_columns</span> <span class="ow">or</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_features_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># this will blow up if the person does not exist</span>
        <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_remaining</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature_name</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_all_features_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">person_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_features_remaining</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_all_with_feature_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a feature/value is &quot;full&quot; we delete everyone else in it.</span>
<span class="sd">        &quot;Full&quot; means that the number selected equals the &quot;max&quot; amount - that</span>
<span class="sd">        is detected elsewhere and then this method is called.</span>
<span class="sd">        Returns count of those deleted, and count of those left</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># when a category is full we want to delete everyone in it</span>
        <span class="n">people_to_delete</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pkey</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature_value</span><span class="p">:</span>
                <span class="n">people_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkey</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
                    <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;SELECTION IMPOSSIBLE: FAIL in delete_all_in_feature_value() &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;as after previous deletion no one/not enough left in </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="si">}</span><span class="s2">. Tried to delete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">people_to_delete</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">remove_many</span><span class="p">(</span><span class="n">people_to_delete</span><span class="p">)</span>
        <span class="c1"># return the number of people deleted and the number of people left</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">people_to_delete</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prune_for_feature_max_0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if any feature_value.max is set to zero. if so delete everyone with that feature value</span>
<span class="sd">        NOT DONE: could then check if anyone is left.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: when do we want to do this?</span>
        <span class="n">msg</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of people: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">total_num_deleted</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">feature_name</span><span class="p">,</span>
            <span class="n">feature_value</span><span class="p">,</span>
            <span class="n">fv_counts</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># we don&#39;t want any of these people</span>
                <span class="c1"># pass the message in as deleting them might throw an exception</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature/value </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2"> full - deleting people...&quot;</span><span class="p">)</span>
                <span class="n">num_deleted</span><span class="p">,</span> <span class="n">num_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_all_with_feature_value</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">)</span>
                <span class="c1"># if no exception was thrown above add this bit to the end of the previous message</span>
                <span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Deleted </span><span class="si">{</span><span class="n">num_deleted</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">num_left</span><span class="si">}</span><span class="s2"> left.&quot;</span>
                <span class="n">total_num_deleted</span> <span class="o">+=</span> <span class="n">num_deleted</span>
        <span class="c1"># if the total number of people deleted is lots then we&#39;re probably doing a replacement selection, which means</span>
        <span class="c1"># the &#39;remaining&#39; file will be useless - remind the user of this!</span>
        <span class="k">if</span> <span class="n">total_num_deleted</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;&gt;&gt;&gt; WARNING &lt;&lt;&lt; That deleted MANY PEOPLE - are you doing a &quot;</span>
                <span class="s2">&quot;replacement? If so your REMAINING FILE WILL BE USELESS!!!&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_person</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selecting a person means:</span>
<span class="sd">        - remove the person from our copy of People</span>
<span class="sd">        - update the `selected` and `remaining` counts of the FeatureCollection</span>
<span class="sd">        - if check_same_address is True, also remove household members (without adding to selected)</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of additional people removed due to same address (empty if check_same_address is False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First, find household members if address checking is enabled (before removing the person)</span>
        <span class="n">household_members_removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">:</span>
            <span class="n">household_members_removed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">matching_address</span><span class="p">(</span><span class="n">person_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">))</span>

        <span class="c1"># Handle the main person selection</span>
        <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_selected</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>

        <span class="c1"># Then remove household members if any were found</span>
        <span class="k">for</span> <span class="n">household_member_key</span> <span class="ow">in</span> <span class="n">household_members_removed</span><span class="p">:</span>
            <span class="n">household_member</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">household_member_key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">household_member</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
                <span class="c1"># Note: we don&#39;t call add_selected() for household members</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">household_member_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">household_members_removed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_max_ratio_category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MaxRatioResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the feature/value combination with the highest selection ratio.</span>

<span class="sd">        The ratio is calculated as: (min - selected) / remaining</span>
<span class="sd">        This represents how urgently we need people from this category.</span>
<span class="sd">        Higher ratio = more urgent need (fewer people available relative to what we still need).</span>

<span class="sd">        Returns:</span>
<span class="sd">            MaxRatioResult containing the feature name, value, and a random person index</span>

<span class="sd">        Raises:</span>
<span class="sd">            SelectionError: If insufficient people remain to meet minimum requirements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_ratio</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.0</span>
        <span class="n">result_feature_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">result_feature_value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">random_person_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="p">(</span>
            <span class="n">feature_name</span><span class="p">,</span>
            <span class="n">feature_value</span><span class="p">,</span>
            <span class="n">fv_counts</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
            <span class="c1"># Check if we have insufficient people to meet minimum requirements</span>
            <span class="n">people_still_needed</span> <span class="o">=</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">min</span> <span class="o">-</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">selected</span>
            <span class="k">if</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">selected</span> <span class="o">&lt;</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span> <span class="o">&lt;</span> <span class="n">people_still_needed</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SELECTION IMPOSSIBLE: Not enough people remaining in </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Need </span><span class="si">{</span><span class="n">people_still_needed</span><span class="si">}</span><span class="s2"> more, but only </span><span class="si">{</span><span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> remaining.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1"># Skip categories with no remaining people or max = 0</span>
            <span class="k">if</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Calculate the priority ratio</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">people_still_needed</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span><span class="p">)</span>

            <span class="c1"># Track the highest ratio category</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="n">max_ratio</span><span class="p">:</span>
                <span class="n">max_ratio</span> <span class="o">=</span> <span class="n">ratio</span>
                <span class="n">result_feature_name</span> <span class="o">=</span> <span class="n">feature_name</span>
                <span class="n">result_feature_value</span> <span class="o">=</span> <span class="n">feature_value</span>
                <span class="c1"># from 1 to remaining</span>
                <span class="n">random_person_index</span> <span class="o">=</span> <span class="n">random_provider</span><span class="p">()</span><span class="o">.</span><span class="n">randbelow</span><span class="p">(</span><span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># If no valid category found, all categories must be at their max or have max=0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result_feature_name</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No valid categories found - all may be at maximum or have max=0&quot;</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MaxRatioResult</span><span class="p">(</span>
            <span class="n">feature_name</span><span class="o">=</span><span class="n">result_feature_name</span><span class="p">,</span>
            <span class="n">feature_value</span><span class="o">=</span><span class="n">result_feature_value</span><span class="p">,</span>
            <span class="n">random_person_index</span><span class="o">=</span><span class="n">random_person_index</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_category_full_deletions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_person_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if any categories are now full after a selection and delete remaining people.</span>

<span class="sd">        When a person is selected, some categories may reach their maximum quota.</span>
<span class="sd">        This method identifies such categories and removes all remaining people from them.</span>

<span class="sd">        Args:</span>
<span class="sd">            selected_person_data: Dictionary of the selected person&#39;s feature values</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of output messages about categories that became full and people deleted</span>

<span class="sd">        Raises:</span>
<span class="sd">            SelectionError: If deletions would violate minimum constraints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_messages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span>
            <span class="n">feature_name</span><span class="p">,</span>
            <span class="n">feature_value</span><span class="p">,</span>
            <span class="n">fv_counts</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">feature_value</span> <span class="o">==</span> <span class="n">selected_person_data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                <span class="n">num_deleted</span><span class="p">,</span> <span class="n">num_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_all_with_feature_value</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_deleted</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">output_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Category </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2"> full - deleted </span><span class="si">{</span><span class="n">num_deleted</span><span class="si">}</span><span class="s2"> people, </span><span class="si">{</span><span class="n">num_left</span><span class="si">}</span><span class="s2"> left.&quot;</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">output_messages</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people_features.PeopleFeatures.delete_all_with_feature_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_all_with_feature_value</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people_features.PeopleFeatures.delete_all_with_feature_value" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>When a feature/value is "full" we delete everyone else in it.
"Full" means that the number selected equals the "max" amount - that
is detected elsewhere and then this method is called.
Returns count of those deleted, and count of those left</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_all_with_feature_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When a feature/value is &quot;full&quot; we delete everyone else in it.</span>
<span class="sd">    &quot;Full&quot; means that the number selected equals the &quot;max&quot; amount - that</span>
<span class="sd">    is detected elsewhere and then this method is called.</span>
<span class="sd">    Returns count of those deleted, and count of those left</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># when a category is full we want to delete everyone in it</span>
    <span class="n">people_to_delete</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pkey</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature_value</span><span class="p">:</span>
            <span class="n">people_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkey</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
                <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;SELECTION IMPOSSIBLE: FAIL in delete_all_in_feature_value() &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;as after previous deletion no one/not enough left in </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="si">}</span><span class="s2">. Tried to delete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">people_to_delete</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">remove_many</span><span class="p">(</span><span class="n">people_to_delete</span><span class="p">)</span>
    <span class="c1"># return the number of people deleted and the number of people left</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">people_to_delete</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people_features.PeopleFeatures.find_max_ratio_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_max_ratio_category</span><span class="p">()</span></code>

<a href="#sortition_algorithms.people_features.PeopleFeatures.find_max_ratio_category" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Find the feature/value combination with the highest selection ratio.</p>
<p>The ratio is calculated as: (min - selected) / remaining
This represents how urgently we need people from this category.
Higher ratio = more urgent need (fewer people available relative to what we still need).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="MaxRatioResult (sortition_algorithms.people_features.MaxRatioResult)" href="#sortition_algorithms.people_features.MaxRatioResult">MaxRatioResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MaxRatioResult containing the feature name, value, and a random person index</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SelectionError">SelectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If insufficient people remain to meet minimum requirements</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_max_ratio_category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MaxRatioResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the feature/value combination with the highest selection ratio.</span>

<span class="sd">    The ratio is calculated as: (min - selected) / remaining</span>
<span class="sd">    This represents how urgently we need people from this category.</span>
<span class="sd">    Higher ratio = more urgent need (fewer people available relative to what we still need).</span>

<span class="sd">    Returns:</span>
<span class="sd">        MaxRatioResult containing the feature name, value, and a random person index</span>

<span class="sd">    Raises:</span>
<span class="sd">        SelectionError: If insufficient people remain to meet minimum requirements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_ratio</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.0</span>
    <span class="n">result_feature_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">result_feature_value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">random_person_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">for</span> <span class="p">(</span>
        <span class="n">feature_name</span><span class="p">,</span>
        <span class="n">feature_value</span><span class="p">,</span>
        <span class="n">fv_counts</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
        <span class="c1"># Check if we have insufficient people to meet minimum requirements</span>
        <span class="n">people_still_needed</span> <span class="o">=</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">min</span> <span class="o">-</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">selected</span>
        <span class="k">if</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">selected</span> <span class="o">&lt;</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span> <span class="o">&lt;</span> <span class="n">people_still_needed</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SELECTION IMPOSSIBLE: Not enough people remaining in </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Need </span><span class="si">{</span><span class="n">people_still_needed</span><span class="si">}</span><span class="s2"> more, but only </span><span class="si">{</span><span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> remaining.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Skip categories with no remaining people or max = 0</span>
        <span class="k">if</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Calculate the priority ratio</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">people_still_needed</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span><span class="p">)</span>

        <span class="c1"># Track the highest ratio category</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="n">max_ratio</span><span class="p">:</span>
            <span class="n">max_ratio</span> <span class="o">=</span> <span class="n">ratio</span>
            <span class="n">result_feature_name</span> <span class="o">=</span> <span class="n">feature_name</span>
            <span class="n">result_feature_value</span> <span class="o">=</span> <span class="n">feature_value</span>
            <span class="c1"># from 1 to remaining</span>
            <span class="n">random_person_index</span> <span class="o">=</span> <span class="n">random_provider</span><span class="p">()</span><span class="o">.</span><span class="n">randbelow</span><span class="p">(</span><span class="n">fv_counts</span><span class="o">.</span><span class="n">remaining</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># If no valid category found, all categories must be at their max or have max=0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result_feature_name</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No valid categories found - all may be at maximum or have max=0&quot;</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">MaxRatioResult</span><span class="p">(</span>
        <span class="n">feature_name</span><span class="o">=</span><span class="n">result_feature_name</span><span class="p">,</span>
        <span class="n">feature_value</span><span class="o">=</span><span class="n">result_feature_value</span><span class="p">,</span>
        <span class="n">random_person_index</span><span class="o">=</span><span class="n">random_person_index</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people_features.PeopleFeatures.handle_category_full_deletions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">handle_category_full_deletions</span><span class="p">(</span><span class="n">selected_person_data</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people_features.PeopleFeatures.handle_category_full_deletions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check if any categories are now full after a selection and delete remaining people.</p>
<p>When a person is selected, some categories may reach their maximum quota.
This method identifies such categories and removes all remaining people from them.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selected_person_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of the selected person's feature values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of output messages about categories that became full and people deleted</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SelectionError">SelectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If deletions would violate minimum constraints</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_category_full_deletions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_person_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if any categories are now full after a selection and delete remaining people.</span>

<span class="sd">    When a person is selected, some categories may reach their maximum quota.</span>
<span class="sd">    This method identifies such categories and removes all remaining people from them.</span>

<span class="sd">    Args:</span>
<span class="sd">        selected_person_data: Dictionary of the selected person&#39;s feature values</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of output messages about categories that became full and people deleted</span>

<span class="sd">    Raises:</span>
<span class="sd">        SelectionError: If deletions would violate minimum constraints</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_messages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span>
        <span class="n">feature_name</span><span class="p">,</span>
        <span class="n">feature_value</span><span class="p">,</span>
        <span class="n">fv_counts</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">feature_value</span> <span class="o">==</span> <span class="n">selected_person_data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="n">num_deleted</span><span class="p">,</span> <span class="n">num_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_all_with_feature_value</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_deleted</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">output_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Category </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2"> full - deleted </span><span class="si">{</span><span class="n">num_deleted</span><span class="si">}</span><span class="s2"> people, </span><span class="si">{</span><span class="n">num_left</span><span class="si">}</span><span class="s2"> left.&quot;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">output_messages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people_features.PeopleFeatures.prune_for_feature_max_0" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prune_for_feature_max_0</span><span class="p">()</span></code>

<a href="#sortition_algorithms.people_features.PeopleFeatures.prune_for_feature_max_0" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check if any feature_value.max is set to zero. if so delete everyone with that feature value
NOT DONE: could then check if anyone is left.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prune_for_feature_max_0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if any feature_value.max is set to zero. if so delete everyone with that feature value</span>
<span class="sd">    NOT DONE: could then check if anyone is left.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: when do we want to do this?</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of people: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">total_num_deleted</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span>
        <span class="n">feature_name</span><span class="p">,</span>
        <span class="n">feature_value</span><span class="p">,</span>
        <span class="n">fv_counts</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># we don&#39;t want any of these people</span>
            <span class="c1"># pass the message in as deleting them might throw an exception</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature/value </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2"> full - deleting people...&quot;</span><span class="p">)</span>
            <span class="n">num_deleted</span><span class="p">,</span> <span class="n">num_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_all_with_feature_value</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">)</span>
            <span class="c1"># if no exception was thrown above add this bit to the end of the previous message</span>
            <span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Deleted </span><span class="si">{</span><span class="n">num_deleted</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">num_left</span><span class="si">}</span><span class="s2"> left.&quot;</span>
            <span class="n">total_num_deleted</span> <span class="o">+=</span> <span class="n">num_deleted</span>
    <span class="c1"># if the total number of people deleted is lots then we&#39;re probably doing a replacement selection, which means</span>
    <span class="c1"># the &#39;remaining&#39; file will be useless - remind the user of this!</span>
    <span class="k">if</span> <span class="n">total_num_deleted</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">count</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;&gt;&gt;&gt; WARNING &lt;&lt;&lt; That deleted MANY PEOPLE - are you doing a &quot;</span>
            <span class="s2">&quot;replacement? If so your REMAINING FILE WILL BE USELESS!!!&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">msg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people_features.PeopleFeatures.select_person" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_person</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people_features.PeopleFeatures.select_person" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Selecting a person means:
- remove the person from our copy of People
- update the <code>selected</code> and <code>remaining</code> counts of the FeatureCollection
- if check_same_address is True, also remove household members (without adding to selected)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of additional people removed due to same address (empty if check_same_address is False)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select_person</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selecting a person means:</span>
<span class="sd">    - remove the person from our copy of People</span>
<span class="sd">    - update the `selected` and `remaining` counts of the FeatureCollection</span>
<span class="sd">    - if check_same_address is True, also remove household members (without adding to selected)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of additional people removed due to same address (empty if check_same_address is False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First, find household members if address checking is enabled (before removing the person)</span>
    <span class="n">household_members_removed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">:</span>
        <span class="n">household_members_removed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">matching_address</span><span class="p">(</span><span class="n">person_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_same_address_columns</span><span class="p">))</span>

    <span class="c1"># Handle the main person selection</span>
    <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_selected</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>

    <span class="c1"># Then remove household members if any were found</span>
    <span class="k">for</span> <span class="n">household_member_key</span> <span class="ow">in</span> <span class="n">household_members_removed</span><span class="p">:</span>
        <span class="n">household_member</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">household_member_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">remove_remaining</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">household_member</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
            <span class="c1"># Note: we don&#39;t call add_selected() for household members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">household_member_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">household_members_removed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.people_features.WeightedSample" class="doc doc-heading">
            <code>WeightedSample</code>


<a href="#sortition_algorithms.people_features.WeightedSample" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WeightedSample</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This produces a set of lists of feature values for each feature.  Each value</span>
<span class="sd">        is in the list `fv_counts.max` times - so a random choice with represent the max.</span>

<span class="sd">        So if we had feature &quot;ethnicity&quot;, value &quot;white&quot; w max 4, &quot;asian&quot; w max 3 and</span>
<span class="sd">        &quot;black&quot; with max 2 we&#39;d get:</span>

<span class="sd">        [&quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;asian&quot;, &quot;asian&quot;, &quot;asian&quot;, &quot;black&quot;, &quot;black&quot;]</span>

<span class="sd">        Then making random choices from that list produces a weighted sample.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">fv_counts</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">value_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># S311 is random numbers for crypto - but this is just for a sample file</span>
        <span class="k">return</span> <span class="n">random_provider</span><span class="p">()</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">[</span><span class="n">feature_name</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people_features.WeightedSample.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">features</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people_features.WeightedSample.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>This produces a set of lists of feature values for each feature.  Each value
is in the list <code>fv_counts.max</code> times - so a random choice with represent the max.</p>
<p>So if we had feature "ethnicity", value "white" w max 4, "asian" w max 3 and
"black" with max 2 we'd get:</p>
<p>["white", "white", "white", "white", "asian", "asian", "asian", "black", "black"]</p>
<p>Then making random choices from that list produces a weighted sample.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This produces a set of lists of feature values for each feature.  Each value</span>
<span class="sd">    is in the list `fv_counts.max` times - so a random choice with represent the max.</span>

<span class="sd">    So if we had feature &quot;ethnicity&quot;, value &quot;white&quot; w max 4, &quot;asian&quot; w max 3 and</span>
<span class="sd">    &quot;black&quot; with max 2 we&#39;d get:</span>

<span class="sd">    [&quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;asian&quot;, &quot;asian&quot;, &quot;asian&quot;, &quot;black&quot;, &quot;black&quot;]</span>

<span class="sd">    Then making random choices from that list produces a weighted sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">fv_counts</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">feature_values_counts</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">fv_counts</span><span class="o">.</span><span class="n">max</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.people_features.simple_add_selected" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simple_add_selected</span><span class="p">(</span><span class="n">person_keys</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people_features.simple_add_selected" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Just add the person to the selected counts for the feature values for that person.
Don't do the more complex handling of the full PeopleFeatures.add_selected()</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simple_add_selected</span><span class="p">(</span><span class="n">person_keys</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">people</span><span class="p">:</span> <span class="n">People</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just add the person to the selected counts for the feature values for that person.</span>
<span class="sd">    Don&#39;t do the more complex handling of the full PeopleFeatures.add_selected()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">person_key</span> <span class="ow">in</span> <span class="n">person_keys</span><span class="p">:</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">get_person_dict</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">add_selected</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">person</span><span class="p">[</span><span class="n">feature_name</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.people"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.people.People" class="doc doc-heading">
            <code>People</code>


<a href="#sortition_algorithms.people.People" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/people.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">People</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns_to_keep</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns_to_keep</span> <span class="o">=</span> <span class="n">columns_to_keep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_full_data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns_to_keep</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns_to_keep</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ItemsView</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">StrippedDict</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">FeatureCollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">person_full_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># get the feature values: these are the most important and we must check them</span>
        <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">feature_values</span><span class="p">():</span>
            <span class="c1"># check for input errors here - if it&#39;s not in the list of feature values...</span>
            <span class="c1"># allow for some unclean data - at least strip empty space, but only if a str!</span>
            <span class="c1"># (some values will can be numbers)</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">p_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_values</span><span class="p">:</span>
                <span class="n">exc_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ERROR reading in people (read_in_people): &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Person (id = </span><span class="si">{</span><span class="n">person_key</span><span class="si">}</span><span class="s2">) has value &#39;</span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">&#39; not in feature </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">BadDataError</span><span class="p">(</span><span class="n">exc_msg</span><span class="p">)</span>
            <span class="n">person_full_data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_value</span>
        <span class="c1"># then get the other column values we need</span>
        <span class="c1"># this is address, name etc that we need to keep for output file</span>
        <span class="c1"># we don&#39;t check anything here - it&#39;s just for user convenience</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns_to_keep</span><span class="p">:</span>
            <span class="n">person_full_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>

        <span class="c1"># add all the data to our people object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="n">person_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">person_full_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="n">person_key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_keys</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">person_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_person_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="n">person_key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">households</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict with:</span>
<span class="sd">        - keys: a tuple containing the address strings</span>
<span class="sd">        - values: a list of person_key for each person at that address</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">households</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">person_key</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_columns</span><span class="p">)</span>
            <span class="n">households</span><span class="p">[</span><span class="n">address</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">households</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">matching_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">address_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of person keys for all people who have an address matching</span>
<span class="sd">        the address of the person passed in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="n">person_key</span><span class="p">]</span>
        <span class="n">person_address</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">loop_key</span><span class="p">,</span> <span class="n">loop_person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">loop_key</span> <span class="o">==</span> <span class="n">person_key</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># skip the person we&#39;ve been given</span>
            <span class="k">if</span> <span class="n">person_address</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">loop_person</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_columns</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">loop_key</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_person_by_position_in_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the nth person (1-indexed) in a specific feature category.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_name: Name of the feature (e.g., &quot;gender&quot;)</span>
<span class="sd">            feature_value: Value of the feature (e.g., &quot;male&quot;)</span>
<span class="sd">            position: 1-indexed position within the category</span>

<span class="sd">        Returns:</span>
<span class="sd">            Person key of the person at the specified position</span>

<span class="sd">        Raises:</span>
<span class="sd">            SelectionError: If no person is found at the specified position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_position</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">person_key</span><span class="p">,</span> <span class="n">person_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">person_dict</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature_value</span><span class="p">:</span>
                <span class="n">current_position</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">current_position</span> <span class="o">==</span> <span class="n">position</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">person_key</span>

        <span class="c1"># Should always find someone if position is valid</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to find person at position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people.People.find_person_by_position_in_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_person_by_position_in_category</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people.People.find_person_by_position_in_category" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Find the nth person (1-indexed) in a specific feature category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feature_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the feature (e.g., "gender")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value of the feature (e.g., "male")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>position</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1-indexed position within the category</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person key of the person at the specified position</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SelectionError">SelectionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no person is found at the specified position</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_person_by_position_in_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the nth person (1-indexed) in a specific feature category.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature_name: Name of the feature (e.g., &quot;gender&quot;)</span>
<span class="sd">        feature_value: Value of the feature (e.g., &quot;male&quot;)</span>
<span class="sd">        position: 1-indexed position within the category</span>

<span class="sd">    Returns:</span>
<span class="sd">        Person key of the person at the specified position</span>

<span class="sd">    Raises:</span>
<span class="sd">        SelectionError: If no person is found at the specified position</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_position</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">person_key</span><span class="p">,</span> <span class="n">person_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">person_dict</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature_value</span><span class="p">:</span>
            <span class="n">current_position</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">current_position</span> <span class="o">==</span> <span class="n">position</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">person_key</span>

    <span class="c1"># Should always find someone if position is valid</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to find person at position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_value</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SelectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people.People.households" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">households</span><span class="p">(</span><span class="n">address_columns</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people.People.households" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generates a dict with:
- keys: a tuple containing the address strings
- values: a list of person_key for each person at that address</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">households</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dict with:</span>
<span class="sd">    - keys: a tuple containing the address strings</span>
<span class="sd">    - values: a list of person_key for each person at that address</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">households</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">person_key</span><span class="p">,</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">address</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_columns</span><span class="p">)</span>
        <span class="n">households</span><span class="p">[</span><span class="n">address</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">households</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sortition_algorithms.people.People.matching_address" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matching_address</span><span class="p">(</span><span class="n">person_key</span><span class="p">,</span> <span class="n">address_columns</span><span class="p">)</span></code>

<a href="#sortition_algorithms.people.People.matching_address" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a list of person keys for all people who have an address matching
the address of the person passed in.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/people.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">matching_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">address_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of person keys for all people who have an address matching</span>
<span class="sd">    the address of the person passed in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="n">person_key</span><span class="p">]</span>
    <span class="n">person_address</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">loop_key</span><span class="p">,</span> <span class="n">loop_person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">loop_key</span> <span class="o">==</span> <span class="n">person_key</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># skip the person we&#39;ve been given</span>
        <span class="k">if</span> <span class="n">person_address</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">loop_person</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">address_columns</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">loop_key</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.settings"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="sortition_algorithms.utils"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.utils.RandomProvider" class="doc doc-heading">
            <code>RandomProvider</code>


<a href="#sortition_algorithms.utils.RandomProvider" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>This is something of a hack. Mostly we want to use the <code>secrets</code> module.
But for repeatable testing we might want to set the random.seed sometimes.</p>
<p>So we have a global <code>_random_provider</code> which can be switched between an
instance of this class that uses the <code>secrets</code> module and an instance that
uses <code>random</code> with a seed. The switch is done by the <code>set_random_provider()</code>
function.</p>
<p>Then every time we want some randomness, we call <code>random_provider()</code> to get
the current version of the global.</p>







              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RandomProvider</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is something of a hack. Mostly we want to use the `secrets` module.</span>
<span class="sd">    But for repeatable testing we might want to set the random.seed sometimes.</span>

<span class="sd">    So we have a global `_random_provider` which can be switched between an</span>
<span class="sd">    instance of this class that uses the `secrets` module and an instance that</span>
<span class="sd">    uses `random` with a seed. The switch is done by the `set_random_provider()`</span>
<span class="sd">    function.</span>

<span class="sd">    Then every time we want some randomness, we call `random_provider()` to get</span>
<span class="sd">    the current version of the global.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uniform</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">randbelow</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">choice</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">seq</span><span class="p">:</span> <span class="s2">&quot;SupportsLenAndGetItem[str]&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sortition_algorithms.utils.StrippedDict" class="doc doc-heading">
            <code>StrippedDict</code>


<a href="#sortition_algorithms.utils.StrippedDict" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Wraps a dict, and whenever we get a value from it, we convert to str and
strip() whitespace</p>







              <details class="quote">
                <summary>Source code in <code>src/sortition_algorithms/utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StrippedDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps a dict, and whenever we get a value from it, we convert to str and</span>
<span class="sd">    strip() whitespace</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_dict</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_dict</span> <span class="o">=</span> <span class="n">raw_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">strip_str_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sortition_algorithms.utils.print_ret" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_ret</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

<a href="#sortition_algorithms.utils.print_ret" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Print and return a message for output collection.</p>


            <details class="quote">
              <summary>Source code in <code>src/sortition_algorithms/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">print_ret</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print and return a message for output collection.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: should we replace this with logging or similar?</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://sortitionfoundation.org">sortitionfoundation</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/sortitionfoundation/sortition-algorithms" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/sortition-algorithms" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>